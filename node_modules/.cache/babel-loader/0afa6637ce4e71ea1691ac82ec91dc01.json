{"ast":null,"code":"import _defineProperty from\"/Users/calvinyung/Desktop/Fall 2020/cs130/project/cs130/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _regeneratorRuntime from\"/Users/calvinyung/Desktop/Fall 2020/cs130/project/cs130/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/calvinyung/Desktop/Fall 2020/cs130/project/cs130/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/calvinyung/Desktop/Fall 2020/cs130/project/cs130/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/calvinyung/Desktop/Fall 2020/cs130/project/cs130/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/calvinyung/Desktop/Fall 2020/cs130/project/cs130/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/calvinyung/Desktop/Fall 2020/cs130/project/cs130/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component,useState}from'react';import GoogleMapReact from'google-map-react';import'./map.css';// for the map, className=\"google-map\"\nimport{Icon}from'@iconify/react';// for map pin\n//import locationIcon from '@iconify/icons-mdi/map-marker' // for map pin\nimport PlaceCard from'../components/PlaceCard';import Marker from'./Marker';import SimpleMarker from'./SimpleMarker';import firebase from'../Firebase';import{Geolocation,Geoposition}from'@ionic-native/geolocation';import{Button,Input,Divider,message}from'antd';import{AnyCnameRecord}from'dns';import{Plugins}from'@capacitor/core';import{IonHeader,IonToolbar,IonTitle,IonContent,IonList,IonItem,IonLabel,IonInput,IonButton,IonPage}from\"@ionic/react\";import App from'../App';var LocalNotifications=Plugins.LocalNotifications;var lats=[37.7313933,37.7413933,37.7413933];var LocationPin=function LocationPin(){return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(SimpleMarker,{name:\"My Marker\",color:\"blue\"}),/*#__PURE__*/React.createElement(\"p\",null,\"1\"));};var Tab1=/*#__PURE__*/function(_Component){_inherits(Tab1,_Component);var _super=_createSuper(Tab1);function Tab1(props){var _this;_classCallCheck(this,Tab1);_this=_super.call(this,props);_this.apiHasLoaded=function(map,mapsApi){_this.setState({mapsLoaded:true,map:map,mapsApi:mapsApi,placesService:new mapsApi.places.PlacesService(map),geoCoderService:new mapsApi.Geocoder(),directionService:new mapsApi.DirectionsService()});};_this.handleSearch=function(){if(_this.state.map==={}){return;}// console.log(this.state.mapsApi);\n// console.log(this.state.map);\n// console.log(this.state.placesService);\n// console.log(this.state.latitude, this.state.longitude);\nvar _this$state=_this.state,markers=_this$state.markers,placesService=_this$state.placesService,directionService=_this$state.directionService,mapsApi=_this$state.mapsApi;var filteredResults=[];var testing_site_latlng_array=[];//if (markers.length === 0){\n//  console.log(\"add marker and try again\");\n//  return;\n//}\nvar markerLatLng=new mapsApi.LatLng(_this.state.latitude,_this.state.longitude);var placesRequest={location:markerLatLng,//radius: '3000000', // Cannot be used with rankBy. Pick your poison!\ntype:['hospital','pharmacy','doctor'],// List of types: https://developers.google.com/places/supported_types\nquery:'covid 19 testing site',rankBy:mapsApi.places.RankBy.DISTANCE};//console.log(placesRequest);\nplacesService.textSearch(placesRequest,function(response){//console.log(response.length)\nvar responseLimit=Math.min(5,response.length);for(var i=0;i<responseLimit;i++){var covidTesting=response[i];var rating=covidTesting.rating,name=covidTesting.name;var address=covidTesting.formatted_address;var lat=covidTesting.geometry.location.lat();var lng=covidTesting.geometry.location.lng();var openNow=false;if(covidTesting.opening_hours){openNow=covidTesting.opening_hours.isOpen();// e.g true/false\n}//console.log(name,address, openNow);\nfilteredResults.push({name:name,address:address,rating:rating,lat:lat,lng:lng,openNow:openNow});_this.setState({searchResults:filteredResults});}//console.log(this.state.searchResults);  \n_this.setState({siteLat0:_this.state.searchResults[0].lat});_this.setState({siteLng0:_this.state.searchResults[0].lng});_this.setState({siteLat1:_this.state.searchResults[1].lat});_this.setState({siteLng1:_this.state.searchResults[1].lng});_this.setState({siteLat2:_this.state.searchResults[2].lat});_this.setState({siteLng2:_this.state.searchResults[2].lng});_this.setState({siteLat3:_this.state.searchResults[3].lat});_this.setState({siteLng3:_this.state.searchResults[3].lng});_this.setState({siteLat4:_this.state.searchResults[4].lat});_this.setState({siteLng4:_this.state.searchResults[4].lng});});};_this.state={mapsLoaded:false,latitude:38,longitude:-118,map:{},mapsApi:{},markers:[],searchResults:[],placesService:{},geoCoderService:{},directionService:{},testing_site_locations:[],// array of {lat: number, lng: number}\nsiteLat0:38,siteLat1:38,siteLat2:38,siteLat3:38,siteLat4:38,siteLng0:-118,siteLng1:-118,siteLng2:-118,siteLng3:-118,siteLng4:-118};return _this;}_createClass(Tab1,[{key:\"componentDidMount\",value:function(){var _componentDidMount=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _this2=this;var id;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return navigator.geolocation.getCurrentPosition(function(position){_this2.setState({latitude:position.coords.latitude,longitude:position.coords.longitude});console.log('Position\\n',position);});case 2:id=navigator.geolocation.watchPosition(function(position){var userLoc={latitude:position.coords.latitude,longitude:position.coords.longitude};console.log(\"Location\\n\",userLoc);var db=firebase.firestore().collection('users');var user=firebase.auth().currentUser;var user_id='';if(user!=null){user_id=user.uid.toString();db.doc(user_id).update({'location':userLoc});_this2.nearPositive(userLoc);}},function(err){if(err.code==1){console.log(\"Error: Access is denied!\");}else if(err.code==2){console.log(\"Error: Position is unavailable!\");}},{timeout:60000,maximumAge:30000});case 3:case\"end\":return _context.stop();}}},_callee);}));function componentDidMount(){return _componentDidMount.apply(this,arguments);}return componentDidMount;}()//if user is near positive user, will send local alert\n},{key:\"nearPositive\",value:function(){var _nearPositive=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(location){var all_usrs,close_usrs;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:all_usrs=firebase.firestore().collection('users');close_usrs=all_usrs.where(location,'==',location).get();alert(\"Num people\",close_usrs.length);_context2.next=5;return LocalNotifications.schedule({notifications:[{title:'Test',body:'test',id:1,schedule:{at:new Date(Date.now())},sound:null}]});case 5:case\"end\":return _context2.stop();}}},_callee2);}));function nearPositive(_x){return _nearPositive.apply(this,arguments);}return nearPositive;}()//    handleClick = () => {\n//        this.componentDidMount();\n//        console.log(\"set longitude:\",this.state.longitude);\n//      }\n//<IonButton color=\"primary\" onClick={this.getLocation}>{this.state.longitude ? `${this.state.latitude} ${this.state.longitude}` : \"Get Location\"}</IonButton>\n},{key:\"render\",value:function render(){var _this3=this,_React$createElement;//const { constraints, mapsLoaded, singaporeLatLng, markers, searchResults } = this.state;\nvar _this$state2=this.state,markers=_this$state2.markers,geoCoderService=_this$state2.geoCoderService,searchResults=_this$state2.searchResults;// Google Maps Services\nreturn/*#__PURE__*/React.createElement(IonPage,null,/*#__PURE__*/React.createElement(IonContent,null,/*#__PURE__*/React.createElement(\"div\",null,\"Current Location: \",JSON.stringify(this.state.latitude),\" ,  \",JSON.stringify(this.state.longitude)),/*#__PURE__*/React.createElement(\"div\",null,\"Initial Location: \",JSON.stringify(this.state.latitude),\" ,  \",JSON.stringify(this.state.longitude)),/*#__PURE__*/React.createElement(\"div\",{className:\"google-map\"},/*#__PURE__*/React.createElement(GoogleMapReact,(_React$createElement={bootstrapURLKeys:{key:\"AIzaSyBj9b-EHxuAAihd8u2HBBqWOSXukFlA3jY\",libraries:['places','directions']},defaultZoom:12,defaultCenter:{lat:38,lng:-118},center:{lat:this.state.latitude,lng:this.state.longitude},yesIWantToUseGoogleMapApiInternals:true},_defineProperty(_React$createElement,\"yesIWantToUseGoogleMapApiInternals\",true),_defineProperty(_React$createElement,\"onGoogleApiLoaded\",function onGoogleApiLoaded(_ref){var map=_ref.map,maps=_ref.maps;return _this3.apiHasLoaded(map,maps);}),_React$createElement),/*#__PURE__*/React.createElement(Marker,{lat:this.state.latitude,lng:this.state.longitude,name:\"My Marker\",color:\"blue\"}),/*#__PURE__*/React.createElement(SimpleMarker,{lat:this.state.siteLat0,lng:this.state.siteLng0,name:\"My Marker\",color:\"red\"}),/*#__PURE__*/React.createElement(SimpleMarker,{lat:this.state.siteLat1,lng:this.state.siteLng1,name:\"My Marker\",color:\"red\"}),/*#__PURE__*/React.createElement(SimpleMarker,{lat:this.state.siteLat2,lng:this.state.siteLng2,name:\"My Marker\",color:\"red\"}),/*#__PURE__*/React.createElement(SimpleMarker,{lat:this.state.siteLat3,lng:this.state.siteLng3,name:\"My Marker\",color:\"red\"}),/*#__PURE__*/React.createElement(SimpleMarker,{lat:this.state.siteLat4,lng:this.state.siteLng4,name:\"My Marker\",color:\"red\"}))),/*#__PURE__*/React.createElement(IonButton,{color:\"primary\",onClick:this.handleSearch},\" \",\"search\",\"  \"),searchResults.length>0?/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"section\",{className:\"col-12\"},/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex flex-column justify-content-center\"},/*#__PURE__*/React.createElement(\"h1\",{className:\"mb-4 fw-md\"},\"Testing Center Nearby\"),/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex flex-wrap\"},searchResults.map(function(result,key){return/*#__PURE__*/React.createElement(PlaceCard,{info:result,key:key});}))))):null));}}]);return Tab1;}(Component);;export default Tab1;","map":{"version":3,"sources":["/Users/calvinyung/Desktop/Fall 2020/cs130/project/cs130/src/pages/Tab1.js"],"names":["React","Component","useState","GoogleMapReact","Icon","PlaceCard","Marker","SimpleMarker","firebase","Geolocation","Geoposition","Button","Input","Divider","message","AnyCnameRecord","Plugins","IonHeader","IonToolbar","IonTitle","IonContent","IonList","IonItem","IonLabel","IonInput","IonButton","IonPage","App","LocalNotifications","lats","LocationPin","Tab1","props","apiHasLoaded","map","mapsApi","setState","mapsLoaded","placesService","places","PlacesService","geoCoderService","Geocoder","directionService","DirectionsService","handleSearch","state","markers","filteredResults","testing_site_latlng_array","markerLatLng","LatLng","latitude","longitude","placesRequest","location","type","query","rankBy","RankBy","DISTANCE","textSearch","response","responseLimit","Math","min","length","i","covidTesting","rating","name","address","formatted_address","lat","geometry","lng","openNow","opening_hours","isOpen","push","searchResults","siteLat0","siteLng0","siteLat1","siteLng1","siteLat2","siteLng2","siteLat3","siteLng3","siteLat4","siteLng4","testing_site_locations","navigator","geolocation","getCurrentPosition","position","coords","console","log","id","watchPosition","userLoc","db","firestore","collection","user","auth","currentUser","user_id","uid","toString","doc","update","nearPositive","err","code","timeout","maximumAge","all_usrs","close_usrs","where","get","alert","schedule","notifications","title","body","at","Date","now","sound","JSON","stringify","key","libraries","maps","result"],"mappings":"irCAAA,MAAOA,CAAAA,KAAP,EAAiBC,SAAjB,CAA2BC,QAA3B,KAA2C,OAA3C,CACA,MAAOC,CAAAA,cAAP,KAA2B,kBAA3B,CACA,MAAO,WAAP,CAAoB;AACpB,OAASC,IAAT,KAAqB,gBAArB,CAAuC;AACvC;AACA,MAAOC,CAAAA,SAAP,KAAsB,yBAAtB,CACA,MAAOC,CAAAA,MAAP,KAAmB,UAAnB,CACA,MAAOC,CAAAA,YAAP,KAAyB,gBAAzB,CACA,MAAOC,CAAAA,QAAP,KAAqB,aAArB,CACA,OAASC,WAAT,CAAsBC,WAAtB,KAAyC,2BAAzC,CACA,OAASC,MAAT,CAAiBC,KAAjB,CAAwBC,OAAxB,CAAiCC,OAAjC,KAAgD,MAAhD,CACA,OAASC,cAAT,KAA+B,KAA/B,CACA,OAAQC,OAAR,KAAsB,iBAAtB,CACA,OACIC,SADJ,CAEIC,UAFJ,CAGIC,QAHJ,CAIIC,UAJJ,CAKIC,OALJ,CAMIC,OANJ,CAOIC,QAPJ,CAQIC,QARJ,CASIC,SATJ,CAUIC,OAVJ,KAWS,cAXT,CAYA,MAAOC,CAAAA,GAAP,KAAgB,QAAhB,C,GAEOC,CAAAA,kB,CAAsBZ,O,CAAtBY,kB,CAEP,GAAMC,CAAAA,IAAI,CAAG,CAAC,UAAD,CAAa,UAAb,CAAyB,UAAzB,CAAb,CACA,GAAMC,CAAAA,WAAW,CAAG,QAAdA,CAAAA,WAAc,sBACpB,4CACE,oBAAC,YAAD,EAAc,IAAI,CAAC,WAAnB,CAA+B,KAAK,CAAC,MAArC,EADF,cAEE,iCAFF,CADoB,EAApB,C,GAQMC,CAAAA,I,4FACF,cAAYC,KAAZ,CAAmB,sCACf,uBAAMA,KAAN,EADe,MA0BnBC,YA1BmB,CA0BH,SAACC,GAAD,CAAMC,OAAN,CAAkB,CAC9B,MAAKC,QAAL,CAAc,CACZC,UAAU,CAAE,IADA,CAEZH,GAAG,CAAEA,GAFO,CAGZC,OAAO,CAAEA,OAHG,CAIZG,aAAa,CAAE,GAAIH,CAAAA,OAAO,CAACI,MAAR,CAAeC,aAAnB,CAAiCN,GAAjC,CAJH,CAKZO,eAAe,CAAE,GAAIN,CAAAA,OAAO,CAACO,QAAZ,EALL,CAMZC,gBAAgB,CAAE,GAAIR,CAAAA,OAAO,CAACS,iBAAZ,EANN,CAAd,EAQH,CAnCkB,OAsCnBC,YAtCmB,CAsCH,UAAM,CACpB,GAAI,MAAKC,KAAL,CAAWZ,GAAX,GAAmB,EAAvB,CAA0B,CACxB,OACD,CACD;AACA;AACA;AACA;AAPoB,gBAQwC,MAAKY,KAR7C,CAQbC,OARa,aAQbA,OARa,CAQJT,aARI,aAQJA,aARI,CAQWK,gBARX,aAQWA,gBARX,CAQ4BR,OAR5B,aAQ4BA,OAR5B,CASlB,GAAMa,CAAAA,eAAe,CAAG,EAAxB,CACA,GAAMC,CAAAA,yBAAyB,CAAG,EAAlC,CACA;AACA;AACA;AACA;AACA,GAAMC,CAAAA,YAAY,CAAG,GAAIf,CAAAA,OAAO,CAACgB,MAAZ,CAAmB,MAAKL,KAAL,CAAWM,QAA9B,CAAwC,MAAKN,KAAL,CAAWO,SAAnD,CAArB,CACA,GAAMC,CAAAA,aAAa,CAAG,CAChBC,QAAQ,CAAEL,YADM,CAEhB;AACAM,IAAI,CAAE,CAAC,UAAD,CAAa,UAAb,CAAwB,QAAxB,CAHU,CAGyB;AACzCC,KAAK,CAAE,uBAJS,CAKhBC,MAAM,CAAEvB,OAAO,CAACI,MAAR,CAAeoB,MAAf,CAAsBC,QALd,CAAtB,CAOE;AACAtB,aAAa,CAACuB,UAAd,CAAyBP,aAAzB,CAAyC,SAACQ,QAAD,CAAc,CACnD;AACA,GAAIC,CAAAA,aAAa,CAAGC,IAAI,CAACC,GAAL,CAAS,CAAT,CAAYH,QAAQ,CAACI,MAArB,CAApB,CACA,IAAK,GAAIC,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGJ,aAApB,CAAmCI,CAAC,EAApC,CAAwC,CACpC,GAAMC,CAAAA,YAAY,CAAGN,QAAQ,CAACK,CAAD,CAA7B,CADoC,GAE5BE,CAAAA,MAF4B,CAEXD,YAFW,CAE5BC,MAF4B,CAEpBC,IAFoB,CAEXF,YAFW,CAEpBE,IAFoB,CAGpC,GAAMC,CAAAA,OAAO,CAAGH,YAAY,CAACI,iBAA7B,CACA,GAAMC,CAAAA,GAAG,CAAGL,YAAY,CAACM,QAAb,CAAsBnB,QAAtB,CAA+BkB,GAA/B,EAAZ,CACA,GAAME,CAAAA,GAAG,CAAGP,YAAY,CAACM,QAAb,CAAsBnB,QAAtB,CAA+BoB,GAA/B,EAAZ,CACA,GAAIC,CAAAA,OAAO,CAAG,KAAd,CACA,GAAIR,YAAY,CAACS,aAAjB,CAAgC,CAC5BD,OAAO,CAAGR,YAAY,CAACS,aAAb,CAA2BC,MAA3B,EAAV,CAA+C;AAClD,CACD;AACA9B,eAAe,CAAC+B,IAAhB,CAAqB,CACnBT,IAAI,CAAJA,IADmB,CAEnBC,OAAO,CAAPA,OAFmB,CAGnBF,MAAM,CAANA,MAHmB,CAInBI,GAAG,CAAHA,GAJmB,CAKnBE,GAAG,CAAHA,GALmB,CAMnBC,OAAO,CAAPA,OANmB,CAArB,EAQA,MAAKxC,QAAL,CAAc,CAAE4C,aAAa,CAAEhC,eAAjB,CAAd,EACH,CACD;AAEA,MAAKZ,QAAL,CAAc,CAAC6C,QAAQ,CAAE,MAAKnC,KAAL,CAAWkC,aAAX,CAAyB,CAAzB,EAA4BP,GAAvC,CAAd,EACA,MAAKrC,QAAL,CAAc,CAAC8C,QAAQ,CAAE,MAAKpC,KAAL,CAAWkC,aAAX,CAAyB,CAAzB,EAA4BL,GAAvC,CAAd,EAEA,MAAKvC,QAAL,CAAc,CAAC+C,QAAQ,CAAE,MAAKrC,KAAL,CAAWkC,aAAX,CAAyB,CAAzB,EAA4BP,GAAvC,CAAd,EACA,MAAKrC,QAAL,CAAc,CAACgD,QAAQ,CAAE,MAAKtC,KAAL,CAAWkC,aAAX,CAAyB,CAAzB,EAA4BL,GAAvC,CAAd,EAEA,MAAKvC,QAAL,CAAc,CAACiD,QAAQ,CAAE,MAAKvC,KAAL,CAAWkC,aAAX,CAAyB,CAAzB,EAA4BP,GAAvC,CAAd,EACA,MAAKrC,QAAL,CAAc,CAACkD,QAAQ,CAAE,MAAKxC,KAAL,CAAWkC,aAAX,CAAyB,CAAzB,EAA4BL,GAAvC,CAAd,EAEA,MAAKvC,QAAL,CAAc,CAACmD,QAAQ,CAAE,MAAKzC,KAAL,CAAWkC,aAAX,CAAyB,CAAzB,EAA4BP,GAAvC,CAAd,EACA,MAAKrC,QAAL,CAAc,CAACoD,QAAQ,CAAE,MAAK1C,KAAL,CAAWkC,aAAX,CAAyB,CAAzB,EAA4BL,GAAvC,CAAd,EAEA,MAAKvC,QAAL,CAAc,CAACqD,QAAQ,CAAE,MAAK3C,KAAL,CAAWkC,aAAX,CAAyB,CAAzB,EAA4BP,GAAvC,CAAd,EACA,MAAKrC,QAAL,CAAc,CAACsD,QAAQ,CAAE,MAAK5C,KAAL,CAAWkC,aAAX,CAAyB,CAAzB,EAA4BL,GAAvC,CAAd,EAEH,CAzCD,EA2CL,CAzGkB,CAEf,MAAK7B,KAAL,CAAa,CACTT,UAAU,CAAE,KADH,CAETe,QAAQ,CAAC,EAFA,CAGTC,SAAS,CAAC,CAAC,GAHF,CAITnB,GAAG,CAAE,EAJI,CAKTC,OAAO,CAAE,EALA,CAMTY,OAAO,CAAE,EANA,CAOTiC,aAAa,CAAE,EAPN,CAQT1C,aAAa,CAAE,EARN,CASTG,eAAe,CAAE,EATR,CAUTE,gBAAgB,CAAE,EAVT,CAWTgD,sBAAsB,CAAE,EAXf,CAWmB;AAC5BV,QAAQ,CAAE,EAZD,CAaTE,QAAQ,CAAE,EAbD,CAcTE,QAAQ,CAAE,EAdD,CAeTE,QAAQ,CAAE,EAfD,CAgBTE,QAAQ,CAAE,EAhBD,CAiBTP,QAAQ,CAAE,CAAC,GAjBF,CAkBTE,QAAQ,CAAE,CAAC,GAlBF,CAmBTE,QAAQ,CAAE,CAAC,GAnBF,CAoBTE,QAAQ,CAAE,CAAC,GApBF,CAqBTE,QAAQ,CAAE,CAAC,GArBF,CAAb,CAFe,aAyBlB,C,4TAmFOE,CAAAA,SAAS,CAACC,WAAV,CAAsBC,kBAAtB,CACF,SAAAC,QAAQ,CAAI,CAAC,MAAI,CAAC3D,QAAL,CAAc,CACvBgB,QAAQ,CAAE2C,QAAQ,CAACC,MAAT,CAAgB5C,QADH,CAEvBC,SAAS,CAAE0C,QAAQ,CAACC,MAAT,CAAgB3C,SAFJ,CAAd,EAIb4C,OAAO,CAACC,GAAR,CAAY,YAAZ,CAA0BH,QAA1B,EAAqC,CALnC,C,QAQFI,E,CAAKP,SAAS,CAACC,WAAV,CAAsBO,aAAtB,CACP,SAACL,QAAD,CAAc,CACZ,GAAMM,CAAAA,OAAO,CAAG,CAACjD,QAAQ,CAAC2C,QAAQ,CAACC,MAAT,CAAgB5C,QAA1B,CAAoCC,SAAS,CAAE0C,QAAQ,CAACC,MAAT,CAAgB3C,SAA/D,CAAhB,CACA4C,OAAO,CAACC,GAAR,CAAY,YAAZ,CAA0BG,OAA1B,EACA,GAAMC,CAAAA,EAAE,CAAG9F,QAAQ,CAAC+F,SAAT,GAAqBC,UAArB,CAAgC,OAAhC,CAAX,CACA,GAAMC,CAAAA,IAAI,CAAGjG,QAAQ,CAACkG,IAAT,GAAgBC,WAA7B,CACA,GAAIC,CAAAA,OAAO,CAAG,EAAd,CACA,GAAIH,IAAI,EAAE,IAAV,CAAe,CACbG,OAAO,CAAGH,IAAI,CAACI,GAAL,CAASC,QAAT,EAAV,CACAR,EAAE,CAACS,GAAH,CAAOH,OAAP,EAAgBI,MAAhB,CAAuB,CAAC,WAAYX,OAAb,CAAvB,EACA,MAAI,CAACY,YAAL,CAAkBZ,OAAlB,EACD,CACF,CAZM,CAaP,SAACa,GAAD,CAAO,CACL,GAAGA,GAAG,CAACC,IAAJ,EAAY,CAAf,CAAkB,CAChBlB,OAAO,CAACC,GAAR,CAAY,0BAAZ,EACD,CAFD,IAEO,IAAIgB,GAAG,CAACC,IAAJ,EAAY,CAAhB,CAAmB,CACxBlB,OAAO,CAACC,GAAR,CAAY,iCAAZ,EACD,CACF,CAnBM,CAoBP,CAACkB,OAAO,CAAE,KAAV,CAAiBC,UAAU,CAAC,KAA5B,CApBO,C,oKAwBX;mIACmB9D,Q,8IACX+D,Q,CAAW9G,QAAQ,CAAC+F,SAAT,GAAqBC,UAArB,CAAgC,OAAhC,C,CACbe,U,CAAaD,QAAQ,CAACE,KAAT,CAAejE,QAAf,CAAyB,IAAzB,CAA+BA,QAA/B,EAAyCkE,GAAzC,E,CACjBC,KAAK,CAAC,YAAD,CAAeH,UAAU,CAACrD,MAA1B,CAAL,C,uBACMtC,CAAAA,kBAAkB,CAAC+F,QAAnB,CAA4B,CAChCC,aAAa,CAAC,CAAC,CACbC,KAAK,CAAE,MADM,CAEbC,IAAI,CAAE,MAFO,CAGb3B,EAAE,CAAE,CAHS,CAIbwB,QAAQ,CAAE,CAACI,EAAE,CAAE,GAAIC,CAAAA,IAAJ,CAASA,IAAI,CAACC,GAAL,EAAT,CAAL,CAJG,CAKbC,KAAK,CAAE,IALM,CAAD,CADkB,CAA5B,C,yJAcZ;AACA;AACA;AACA;AAGM;uCACQ,sCAER;AAFQ,iBAG2C,KAAKpF,KAHhD,CAGAC,OAHA,cAGAA,OAHA,CAGSN,eAHT,cAGSA,eAHT,CAGyBuC,aAHzB,cAGyBA,aAHzB,CAGuD;AAC/D,mBACQ,oBAAC,OAAD,mBAUA,oBAAC,UAAD,mBACA,oDAAwBmD,IAAI,CAACC,SAAL,CAAe,KAAKtF,KAAL,CAAWM,QAA1B,CAAxB,QAAmE+E,IAAI,CAACC,SAAL,CAAe,KAAKtF,KAAL,CAAWO,SAA1B,CAAnE,CADA,cAEA,oDAAwB8E,IAAI,CAACC,SAAL,CAAe,KAAKtF,KAAL,CAAWM,QAA1B,CAAxB,QAAkE+E,IAAI,CAACC,SAAL,CAAe,KAAKtF,KAAL,CAAWO,SAA1B,CAAlE,CAFA,cAIF,2BAAK,SAAS,CAAC,YAAf,eACA,oBAAC,cAAD,wBACE,gBAAgB,CAAE,CAChBgF,GAAG,CAAE,yCADW,CAEhBC,SAAS,CAAE,CAAC,QAAD,CAAW,YAAX,CAFK,CADpB,CAKE,WAAW,CAAE,EALf,CAME,aAAa,CAAE,CAAE7D,GAAG,CAAE,EAAP,CAAWE,GAAG,CAAE,CAAC,GAAjB,CANjB,CAOE,MAAM,CAAE,CAAEF,GAAG,CAAE,KAAK3B,KAAL,CAAWM,QAAlB,CAA4BuB,GAAG,CAAE,KAAK7B,KAAL,CAAWO,SAA5C,CAPV,CAQE,kCAAkC,CAAE,IARtC,2IAUqB,oCAAGnB,CAAAA,GAAH,MAAGA,GAAH,CAAQqG,IAAR,MAAQA,IAAR,OAAmB,CAAA,MAAI,CAACtG,YAAL,CAAkBC,GAAlB,CAAuBqG,IAAvB,CAAnB,EAVrB,qCAcC,oBAAC,MAAD,EAAQ,GAAG,CAAE,KAAKzF,KAAL,CAAWM,QAAxB,CAAkC,GAAG,CAAE,KAAKN,KAAL,CAAWO,SAAlD,CAA6D,IAAI,CAAC,WAAlE,CAA8E,KAAK,CAAC,MAApF,EAdD,cAeC,oBAAC,YAAD,EAAc,GAAG,CAAE,KAAKP,KAAL,CAAWmC,QAA9B,CAAwC,GAAG,CAAE,KAAKnC,KAAL,CAAWoC,QAAxD,CAAkE,IAAI,CAAC,WAAvE,CAAmF,KAAK,CAAC,KAAzF,EAfD,cAgBC,oBAAC,YAAD,EAAc,GAAG,CAAE,KAAKpC,KAAL,CAAWqC,QAA9B,CAAwC,GAAG,CAAE,KAAKrC,KAAL,CAAWsC,QAAxD,CAAkE,IAAI,CAAC,WAAvE,CAAmF,KAAK,CAAC,KAAzF,EAhBD,cAiBC,oBAAC,YAAD,EAAc,GAAG,CAAE,KAAKtC,KAAL,CAAWuC,QAA9B,CAAwC,GAAG,CAAE,KAAKvC,KAAL,CAAWwC,QAAxD,CAAkE,IAAI,CAAC,WAAvE,CAAmF,KAAK,CAAC,KAAzF,EAjBD,cAkBC,oBAAC,YAAD,EAAc,GAAG,CAAE,KAAKxC,KAAL,CAAWyC,QAA9B,CAAwC,GAAG,CAAE,KAAKzC,KAAL,CAAW0C,QAAxD,CAAkE,IAAI,CAAC,WAAvE,CAAmF,KAAK,CAAC,KAAzF,EAlBD,cAmBC,oBAAC,YAAD,EAAc,GAAG,CAAE,KAAK1C,KAAL,CAAW2C,QAA9B,CAAwC,GAAG,CAAE,KAAK3C,KAAL,CAAW4C,QAAxD,CAAkE,IAAI,CAAC,WAAvE,CAAmF,KAAK,CAAC,KAAzF,EAnBD,CADA,CAJE,cAiCA,oBAAC,SAAD,EAAW,KAAK,CAAC,SAAjB,CAA2B,OAAO,CAAE,KAAK7C,YAAzC,MAAyD,QAAzD,MAjCA,CAqCDmC,aAAa,CAACd,MAAd,CAAuB,CAAvB,cACE,qDAEP,+BAAS,SAAS,CAAC,QAAnB,eACA,2BAAK,SAAS,CAAC,2CAAf,eAEQ,0BAAI,SAAS,CAAC,YAAd,0BAFR,cAIW,2BAAK,SAAS,CAAC,kBAAf,EACIc,aAAa,CAAC9C,GAAd,CAAkB,SAACsG,MAAD,CAASH,GAAT,qBAAkB,oBAAC,SAAD,EAAW,IAAI,CAAEG,MAAjB,CAAyB,GAAG,CAAEH,GAA9B,EAAlB,EAAlB,CADJ,CAJX,CADA,CAFO,CADF,CAeI,IApDH,CAVA,CADR,CAoEC,C,kBA/OYpI,S,EAiPhB,CAKD,cAAe8B,CAAAA,IAAf","sourcesContent":["import React,  { Component,useState } from 'react';\nimport GoogleMapReact from 'google-map-react';\nimport './map.css'  // for the map, className=\"google-map\"\nimport { Icon } from '@iconify/react'  // for map pin\n//import locationIcon from '@iconify/icons-mdi/map-marker' // for map pin\nimport PlaceCard from '../components/PlaceCard';\nimport Marker from './Marker';\nimport SimpleMarker from './SimpleMarker';\nimport firebase from '../Firebase';\nimport { Geolocation, Geoposition } from '@ionic-native/geolocation';\nimport { Button, Input, Divider, message } from 'antd';\nimport { AnyCnameRecord } from 'dns';\nimport {Plugins} from '@capacitor/core';\nimport {\n    IonHeader,\n    IonToolbar,\n    IonTitle,\n    IonContent,\n    IonList,\n    IonItem,\n    IonLabel,\n    IonInput,\n    IonButton,\n    IonPage\n  } from \"@ionic/react\";\nimport App from '../App';\n\nconst {LocalNotifications} = Plugins;\n\nconst lats = [37.7313933, 37.7413933, 37.7413933]\nconst LocationPin = () => (\n<div>\n  <SimpleMarker name=\"My Marker\" color=\"blue\"/>\n  <p>1</p>\n</div>\n\n)\n\nclass Tab1 extends Component  {\n    constructor(props) {\n        super(props);\n        this.state = {\n            mapsLoaded: false,     \n            latitude:38,\n            longitude:-118,\n            map: {},\n            mapsApi: {},\n            markers: [],\n            searchResults: [],\n            placesService: {},\n            geoCoderService: {},\n            directionService: {},\n            testing_site_locations: [], // array of {lat: number, lng: number}\n            siteLat0: 38,\n            siteLat1: 38, \n            siteLat2: 38,\n            siteLat3: 38,\n            siteLat4: 38,\n            siteLng0: -118,\n            siteLng1: -118,\n            siteLng2: -118,\n            siteLng3: -118,\n            siteLng4: -118,\n        };\n    }\n    apiHasLoaded = ((map, mapsApi) => {\n        this.setState({\n          mapsLoaded: true,\n          map: map,\n          mapsApi: mapsApi,\n          placesService: new mapsApi.places.PlacesService(map),\n          geoCoderService: new mapsApi.Geocoder(),\n          directionService: new mapsApi.DirectionsService(),\n        });\n    });\n    \n\n    handleSearch = (() => {\n      if (this.state.map === {}){\n        return\n      }\n      // console.log(this.state.mapsApi);\n      // console.log(this.state.map);\n      // console.log(this.state.placesService);\n      // console.log(this.state.latitude, this.state.longitude);\n        let {markers, placesService, directionService,mapsApi } = this.state;\n        const filteredResults = [];\n        const testing_site_latlng_array = [];\n        //if (markers.length === 0){\n        //  console.log(\"add marker and try again\");\n        //  return;\n        //}\n        const markerLatLng = new mapsApi.LatLng(this.state.latitude, this.state.longitude);\n        const placesRequest = {\n              location: markerLatLng,\n              //radius: '3000000', // Cannot be used with rankBy. Pick your poison!\n              type: ['hospital', 'pharmacy','doctor'], // List of types: https://developers.google.com/places/supported_types\n              query: 'covid 19 testing site',\n              rankBy: mapsApi.places.RankBy.DISTANCE,\n          }\n          //console.log(placesRequest);\n          placesService.textSearch(placesRequest, ((response) => {\n              //console.log(response.length)\n              let responseLimit = Math.min(5, response.length);\n              for (let i = 0; i < responseLimit; i++) {\n                  const covidTesting = response[i];\n                  const { rating, name } = covidTesting;\n                  const address = covidTesting.formatted_address; \n                  const lat = covidTesting.geometry.location.lat();\n                  const lng = covidTesting.geometry.location.lng();\n                  let openNow = false;\n                  if (covidTesting.opening_hours) {\n                      openNow = covidTesting.opening_hours.isOpen(); // e.g true/false\n                  }\n                  //console.log(name,address, openNow);\n                  filteredResults.push({\n                    name,\n                    address,\n                    rating,\n                    lat, \n                    lng,\n                    openNow,\n                  });\n                  this.setState({ searchResults: filteredResults });\n              }\n              //console.log(this.state.searchResults);  \n\n              this.setState({siteLat0: this.state.searchResults[0].lat})\n              this.setState({siteLng0: this.state.searchResults[0].lng})\n\n              this.setState({siteLat1: this.state.searchResults[1].lat})\n              this.setState({siteLng1: this.state.searchResults[1].lng})\n\n              this.setState({siteLat2: this.state.searchResults[2].lat})\n              this.setState({siteLng2: this.state.searchResults[2].lng})\n\n              this.setState({siteLat3: this.state.searchResults[3].lat})\n              this.setState({siteLng3: this.state.searchResults[3].lng})\n\n              this.setState({siteLat4: this.state.searchResults[4].lat})\n              this.setState({siteLng4: this.state.searchResults[4].lng})\n              \n          }\n          ))\n    });\n    \n    async componentDidMount() {\n      await navigator.geolocation.getCurrentPosition(\n          position => {this.setState({ \n              latitude: position.coords.latitude, \n              longitude: position.coords.longitude\n          });\n          console.log('Position\\n', position);}\n      )\n      \n      var id = navigator.geolocation.watchPosition(\n        (position) => {\n          const userLoc = {latitude:position.coords.latitude, longitude: position.coords.longitude};\n          console.log(\"Location\\n\", userLoc);\n          const db = firebase.firestore().collection('users');\n          const user = firebase.auth().currentUser;\n          var user_id = '';\n          if (user!=null){\n            user_id = user.uid.toString();\n            db.doc(user_id).update({'location': userLoc});\n            this.nearPositive(userLoc);\n          }\n        }, \n        (err)=>{\n          if(err.code == 1) {\n            console.log(\"Error: Access is denied!\");\n          } else if( err.code == 2) {\n            console.log(\"Error: Position is unavailable!\");\n          }\n        }, \n        {timeout: 60000, maximumAge:30000}\n      );\n    }\n\n    //if user is near positive user, will send local alert\n    async nearPositive(location){\n      const all_usrs = firebase.firestore().collection('users');\n      let close_usrs = all_usrs.where(location, '==', location).get();\n      alert(\"Num people\", close_usrs.length);\n      await LocalNotifications.schedule({\n        notifications:[{\n          title: 'Test',\n          body: 'test',\n          id: 1,\n          schedule: {at: new Date(Date.now()) },\n          sound: null\n          }\n        ]\n      });\n    }\n\n\n\n//    handleClick = () => {\n//        this.componentDidMount();\n//        console.log(\"set longitude:\",this.state.longitude);\n//      }\n      \n\n      //<IonButton color=\"primary\" onClick={this.getLocation}>{this.state.longitude ? `${this.state.latitude} ${this.state.longitude}` : \"Get Location\"}</IonButton>\n      render(){\n\n      //const { constraints, mapsLoaded, singaporeLatLng, markers, searchResults } = this.state;\n      const { markers, geoCoderService,searchResults } = this.state; // Google Maps Services\n      return(\n              <IonPage>\n\n                      {/* \n              <IonHeader>\n                <IonToolbar color=\"primary\">\n                  <IonTitle>Login</IonTitle>\n                </IonToolbar>\n              </IonHeader>\n                        */}\n\n              <IonContent>\n              <div>Current Location: {JSON.stringify(this.state.latitude  )} ,  {JSON.stringify(this.state.longitude )}</div> \n              <div>Initial Location: {JSON.stringify(this.state.latitude )} ,  {JSON.stringify(this.state.longitude)}</div>               \n{/*************** Maps Section ******************************************************************************/}              \n            <div className=\"google-map\">\n            <GoogleMapReact\n              bootstrapURLKeys={{\n                key: \"AIzaSyBj9b-EHxuAAihd8u2HBBqWOSXukFlA3jY\",\n                libraries: ['places', 'directions']\n              }}\n              defaultZoom={12}\n              defaultCenter={{ lat: 38, lng: -118 }}\n              center={{ lat: this.state.latitude, lng: this.state.longitude }}\n              yesIWantToUseGoogleMapApiInternals={true}\n              yesIWantToUseGoogleMapApiInternals\n              onGoogleApiLoaded={({ map, maps }) => this.apiHasLoaded(map, maps)} // \"maps\" is the mapApi. Bad naming but that's their library.\n\n            >\n\n             <Marker lat={this.state.latitude} lng={this.state.longitude} name=\"My Marker\" color=\"blue\"/>\n             <SimpleMarker lat={this.state.siteLat0} lng={this.state.siteLng0} name=\"My Marker\" color=\"red\"/>\n             <SimpleMarker lat={this.state.siteLat1} lng={this.state.siteLng1} name=\"My Marker\" color=\"red\"/>\n             <SimpleMarker lat={this.state.siteLat2} lng={this.state.siteLng2} name=\"My Marker\" color=\"red\"/>\n             <SimpleMarker lat={this.state.siteLat3} lng={this.state.siteLng3} name=\"My Marker\" color=\"red\"/>\n             <SimpleMarker lat={this.state.siteLat4} lng={this.state.siteLng4} name=\"My Marker\" color=\"red\"/>\n\n\n\n               </GoogleMapReact>\n               </div>\n\n\n{/*************** Search Button ******************************************************************************/}           \n              <IonButton color=\"primary\" onClick={this.handleSearch}> {\"search\"}  </IonButton> \n\n\n{/*************** Result Section ******************************************************************************/}\n            {searchResults.length > 0 ? \n               <>\n\n        <section className=\"col-12\">\n        <div className=\"d-flex flex-column justify-content-center\">\n\n                <h1 className=\"mb-4 fw-md\">Testing Center Nearby</h1>\n\n                   <div className=\"d-flex flex-wrap\">\n                      {searchResults.map((result, key) => (<PlaceCard info={result} key={key} />))}\n                  </div>\n\n        </div>                        \n        </section>               \n               </>\n               : null}\n\n                </IonContent>\n                </IonPage>\n            );\n      }\n    \n  };\n  \n  \n  \n  \n  export default Tab1;"]},"metadata":{},"sourceType":"module"}